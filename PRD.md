这份文档是 **StartDeck** 的核心需求说明书（PRD）。它详细定义了软件“必须做什么”以及“做到什么程度”，是开发、测试和验收的唯一标准。

---

# StartDeck 产品需求文档 (PRD) v1.0

## 1. 引言 (Introduction)

### 1.1 产品背景
Windows 11 的原生开始菜单因强制网格排列、推荐内容干扰以及层级繁琐，导致部分用户（尤其是追求效率的高级用户）体验下降。现有的第三方替代品（如 Start11）往往过于臃肿或侵入系统底层。

### 1.2 产品目标
开发一款名为 **StartDeck** 的轻量级 Windows 启动器。
*   **核心价值：** 零配置、原生 UI 体验、极速启动。
*   **产品形态：** 作为一个独立的 `.exe` 运行，固定在任务栏，点击弹出，模拟系统级菜单体验。

### 1.3 适用范围
*   **操作系统：** Windows 11 (主要适配), Windows 10 (兼容适配)。
*   **目标用户：** 开发者、设计师、极客以及任何对 Win11 开始菜单不满的用户。

---

## 2. 功能需求 (Functional Requirements)

### 2.1 启动与激活 (Activation)
*   **FR-01 任务栏触发：** 用户点击任务栏上的 StartDeck 图标时：
    *   若窗口未显示，则在图标上方显示窗口。
    *   若窗口已显示，则隐藏窗口。
*   **FR-02 单例运行：** 软件必须保证同一时间只有一个进程在运行。再次运行软件应仅触发“唤醒”动作，而非启动新实例。
*   **FR-03 失焦隐藏：** 当用户点击 StartDeck 窗口以外的任何区域（桌面、其他窗口）时，窗口必须立即自动隐藏。

### 2.2 数据扫描与处理 (Data Processing)
*   **FR-04 自动扫描：** 软件启动时（及手动刷新时），自动递归扫描以下两个目录：
    *   `%ProgramData%\Microsoft\Windows\Start Menu\Programs` (系统级)
    *   `%AppData%\Microsoft\Windows\Start Menu\Programs` (用户级)
*   **FR-05 智能过滤：**
    *   **文件类型：** 仅保留 `.lnk` (快捷方式)。
    *   **关键词屏蔽：** 自动剔除包含以下关键词的快捷方式（不区分大小写）：`uninstall`, `卸载`, `help`, `帮助`, `readme`, `说明`, `website`, `网站`, `url`.
*   **FR-06 智能去重：** 若系统级目录和用户级目录存在同名应用（或同名文件夹），优先保留**用户级目录**的内容。
*   **FR-07 分组逻辑：**
    *   根目录下的快捷方式归入“未分类”或“常用”组。
    *   一级子文件夹名称直接作为“分组标题”（如 "Adobe", "Microsoft Office"）。
    *   不显示空文件夹。

### 2.3 应用执行 (Execution)
*   **FR-08 启动应用：** 左键单击图标，启动对应的应用程序，并立即隐藏 StartDeck 窗口。
*   **FR-09 上下文菜单：** 右键单击图标，弹出原生风格菜单，包含：
    *   以管理员身份运行 (Run as Administrator)
    *   打开文件所在位置 (Open File Location)

### 2.4 系统控制 (System Control)
*   **FR-10 底部栏功能：**
    *   显示当前登录用户的头像和用户名。
    *   提供电源菜单按钮，点击弹出：关机、重启、睡眠。

---

## 3. 非功能需求 (Non-Functional Requirements)

### 3.1 性能要求 (Performance)
*   **NFR-01 启动速度：** 点击任务栏图标到窗口完全渲染可见，延迟不超过 **200ms**。
*   **NFR-02 内存占用：** 后台静默挂起时，物理内存占用需控制在 **30MB** 以内。
*   **NFR-03 滚动流畅度：** 应用列表滚动必须保持 60fps，无明显掉帧。

### 3.2 技术约束 (Technical Constraints)
*   **NFR-04 技术栈：** C# / .NET 8 / WinUI 3。
*   **NFR-05 编译方式：** 必须支持 **Native AOT** 编译，生成单一无依赖的 `.exe` 文件。
*   **NFR-06 权限：** 软件默认以普通用户权限运行，仅在执行“管理员运行”操作时请求提权。

### 3.3 可靠性 (Reliability)
*   **NFR-07 异常处理：** 遇到损坏的快捷方式（指向不存在的文件）时，软件不得崩溃，应静默跳过或显示默认图标。
*   **NFR-08 分辨率适配：** 必须完美支持 100% - 200% 的 DPI 缩放，图标和文字不模糊。

---

## 4. UI/UX 详细规范 (User Interface)

### 4.1 窗口样式
*   **尺寸：** 固定宽度（建议 600px - 700px），高度自适应或固定（建议 500px - 600px）。
*   **材质：** 背景使用 **Mica Alt** (云母) 材质，呈现半透明磨砂质感。
*   **边框：** 无系统标题栏，四周有 1px 的高亮边框（Accent Color 或半透明白）。
*   **圆角：** 窗口四角半径为 8px (Win11 标准)。

### 4.2 内容布局
*   **顶部 (Header)：**
    *   左侧：应用名称 (StartDeck)。
    *   右侧：搜索栏（预留位置，MVP版本可暂不可用）、刷新按钮。
*   **中部 (Content)：**
    *   采用流式布局。
    *   **分组标题：** 14px 字体，60% 透明度，下边距 8px。
    *   **应用网格：** 
        *   单元格尺寸：宽约 80-90px，高约 80px。
        *   图标尺寸：32x32px。
        *   文字：12px，居中，最多显示 2 行，超出部分省略号。
*   **底部 (Footer)：**
    *   固定在窗口底部，背景色比主背景稍深（增加层次感）。
    *   高度约 48px。

### 4.3 交互动效
*   **进入动画：** 窗口显示时，应用 `EntranceThemeTransition`，产生轻微的从下往上位移和淡入效果。
*   **悬停效果：** 鼠标悬停在应用图标上时，显示圆角矩形背景 (`SystemControlHighlightListLowBrush`)。
*   **点击反馈：** 点击图标瞬间，图标有轻微缩放或下沉效果 (`Tilt` 效果)。

---

## 5. 数据逻辑细则 (Data Logic)

### 5.1 图标提取逻辑
由于 `.lnk` 文件本身可能不包含图标（指向 exe），或者包含的是低清图标，提取逻辑如下：
1.  读取 `.lnk` 指向的目标路径 (`Target Path`)。
2.  调用 Windows API `SHGetFileInfo` 获取该路径的大图标 (LargeIcon)。
3.  如果获取失败，尝试 `ExtractIconEx`。
4.  如果目标是文件夹，使用系统默认文件夹图标。
5.  如果以上都失败，使用软件内置的“未知应用”占位图标。

### 5.2 排序逻辑
*   **分组排序：** 按文件夹名称 A-Z 排序。
*   **组内排序：** 按应用名称 A-Z 排序。
*   **特殊规则：** 中文名称按拼音首字母排序。

---

## 6. 交付物清单 (Deliverables)

1.  **源代码：** 完整的 Visual Studio 解决方案，包含所有资源文件。
2.  **可执行文件：** 编译后的 `StartDeck.exe` (Release, Native AOT)。
3.  **说明文档：** 简要的 Readme，说明如何固定到任务栏。

---

## 7. 版本规划 (Roadmap)

### v1.0 (MVP - 本次开发目标)
*   实现上述所有核心功能。
*   确保稳定读取开始菜单并显示。
*   完成 Win11 原生 UI 适配。

### v1.1 (未来规划 - 暂不开发)
*   支持搜索功能 (即时检索)。
*   支持手动隐藏/显示特定分组。
*   支持将常用应用“钉”在顶部。