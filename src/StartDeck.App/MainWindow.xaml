<Window
    x:Class="StartDeck.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:StartDeck"
    xmlns:viewModels="using:StartDeck.ViewModels"
    ExtendsContentIntoTitleBar="True">
    <Grid Background="{ThemeResource MicaBaseAltBackground}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="48" />
        </Grid.RowDefinitions>

        <!-- Header -->
        <Grid Grid.Row="0" Padding="16,12" ColumnSpacing="12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <TextBlock Text="StartDeck" FontSize="18" FontWeight="SemiBold" VerticalAlignment="Center" />
            <TextBox Grid.Column="1" PlaceholderText="Search (reserved)" IsEnabled="False" Opacity="0.6" VerticalAlignment="Center" />
            <Button Grid.Column="2" Content="⟳" Width="32" Height="32" VerticalAlignment="Center" Click="OnRefreshClick" />
        </Grid>

        <!-- Content -->
        <ScrollViewer Grid.Row="1" Padding="16,8" VerticalScrollBarVisibility="Auto">
            <ItemsControl x:Name="GroupRepeater" ItemsSource="{x:Bind Groups}">
                <ItemsControl.ItemTemplate>
                    <DataTemplate x:DataType="viewModels:GroupViewModel">
                        <StackPanel Spacing="8" x:Phase="0">
                            <TextBlock Text="{x:Bind Name}"
                                       FontSize="14"
                                       Opacity="0.6"
                                       Margin="0,0,0,8" />
                            <GridView ItemsSource="{x:Bind Items}"
                                      IsItemClickEnabled="True"
                                      SelectionMode="None"
                                      ItemClick="OnItemClick"
                                      IsDoubleTapEnabled="False"
                                      IsTabStop="False">
                                <GridView.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <ItemsWrapGrid Orientation="Horizontal" MaximumRowsOrColumns="0" />
                                    </ItemsPanelTemplate>
                                </GridView.ItemsPanel>
                                <GridView.ItemContainerTransitions>
                                    <TransitionCollection>
                                        <EntranceThemeTransition />
                                    </TransitionCollection>
                                </GridView.ItemContainerTransitions>
                                <GridView.ItemTemplate>
                                    <DataTemplate x:DataType="viewModels:AppEntryViewModel">
                                        <Grid Width="90" Height="80" Padding="8" x:Phase="0">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto" />
                                                <RowDefinition Height="*" />
                                            </Grid.RowDefinitions>
                                            <Grid.ContextFlyout>
                                                <MenuFlyout>
                                                    <MenuFlyoutItem Text="Run as administrator" Click="OnRunAsAdminClick" />
                                                    <MenuFlyoutItem Text="Open file location" Click="OnOpenLocationClick" />
                                                </MenuFlyout>
                                            </Grid.ContextFlyout>
                                            <Border Width="48" Height="48" HorizontalAlignment="Center" VerticalAlignment="Center" CornerRadius="8" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
                                                <Image Source="{x:Bind Icon}" Stretch="Uniform" Width="32" Height="32" x:Phase="2" />
                                            </Border>
                                            <TextBlock Grid.Row="1"
                                                       Text="{x:Bind Name}"
                                                       TextWrapping="Wrap"
                                                       TextTrimming="CharacterEllipsis"
                                                       TextAlignment="Center"
                                                       FontSize="12"
                                                       MaxLines="2"
                                                       Margin="0,8,0,0"
                                                       x:Phase="1" />
                                        </Grid>
                                    </DataTemplate>
                                </GridView.ItemTemplate>
                            </GridView>
                        </StackPanel>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- Footer -->
        <Grid Grid.Row="2" Background="{ThemeResource SolidBackgroundFillColorTertiaryBrush}" Padding="12" ColumnSpacing="12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <StackPanel Orientation="Horizontal" Spacing="8" VerticalAlignment="Center">
                <Ellipse Width="32" Height="32" Fill="{ThemeResource AccentFillColorDefaultBrush}" />
                <StackPanel>
                    <TextBlock x:Name="UserDisplayName" Text="User" FontWeight="SemiBold" />
                    <TextBlock x:Name="UserName" Text="username" Opacity="0.6" FontSize="12" />
                </StackPanel>
            </StackPanel>
            <Button Grid.Column="2" Content="⏻" Width="36" Height="36" VerticalAlignment="Center">
                <Button.Flyout>
                    <MenuFlyout>
                        <MenuFlyoutItem Text="Sleep" Click="OnSleepClick" />
                        <MenuFlyoutItem Text="Restart" Click="OnRestartClick" />
                        <MenuFlyoutItem Text="Shut down" Click="OnShutdownClick" />
                    </MenuFlyout>
                </Button.Flyout>
            </Button>
        </Grid>
    </Grid>
</Window>
